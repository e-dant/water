#!/usr/bin/env bash

cd $(dirname $0)

thisdir="$PWD"
outdir="$thisdir/out"
srcdir="$thisdir/../src/llvm"
exitval=0

cd $outdir || exit 1

#  -DLLVM_ENABLE_RUNTIMES=all

if cmake \
  -DLLVM_ENABLE_PROJECTS='clang;clang-tools-extra;libc;libcxx;libcxxabi;lld' \
  -DCMAKE_BUILD_TYPE='Release' \
  -G 'Ninja' "$srcdir"; then
  if cmake --build "$outdir"; then
    exit 0
  else
    echo build failed
    exitval=$((exitval + 1))
  fi
else
  echo cmake failed
  exitval=$((exitval + 1))
fi

cd $thisdir
exit $exitval
